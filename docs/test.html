<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Testing | Delivering Data Science Products via Packages</title>
  <meta name="description" content="Creating R and Python packages to scale data science." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Testing | Delivering Data Science Products via Packages" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Creating R and Python packages to scale data science." />
  <meta name="github-repo" content="bradleyboehmke/misk-packages" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Testing | Delivering Data Science Products via Packages" />
  
  <meta name="twitter:description" content="Creating R and Python packages to scale data science." />
  



<meta name="date" content="2020-06-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="code.html"/>
<link rel="next" href="object-docs.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Creating Packages</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-should-read-this"><i class="fa fa-check"></i>Who should read this</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-need-for-this-book"><i class="fa fa-check"></i>What you need for this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#conventions-used-in-this-book"><i class="fa fa-check"></i>Conventions used in this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#feedback"><i class="fa fa-check"></i>Feedback</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="part"><span><b>I Getting Started</b></span></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction to Packaging</a><ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#why-is-packaging-important"><i class="fa fa-check"></i><b>2.1</b> Why is packaging important</a></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#when-packaging-might-not-be-needed"><i class="fa fa-check"></i><b>2.2</b> When packaging might not be needed</a></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#an-opinionated-approach"><i class="fa fa-check"></i><b>2.3</b> An opinionated approach</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structure.html"><a href="structure.html"><i class="fa fa-check"></i><b>3</b> Package Structure</a><ul>
<li class="chapter" data-level="3.1" data-path="structure.html"><a href="structure.html#example"><i class="fa fa-check"></i><b>3.1</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</a></li>
<li class="chapter" data-level="3.2" data-path="structure.html"><a href="structure.html#example-1"><i class="fa fa-check"></i><b>3.2</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>4</b> Development Workflow</a><ul>
<li class="chapter" data-level="4.1" data-path="workflow.html"><a href="workflow.html#create-the-package"><i class="fa fa-check"></i><b>4.1</b> Create the package</a><ul>
<li class="chapter" data-level="4.1.1" data-path="workflow.html"><a href="workflow.html#naming"><i class="fa fa-check"></i><b>4.1.1</b> Naming</a></li>
<li class="chapter" data-level="4.1.2" data-path="workflow.html"><a href="workflow.html#create"><i class="fa fa-check"></i><b>4.1.2</b> Create</a></li>
<li class="chapter" data-level="4.1.3" data-path="workflow.html"><a href="workflow.html#version-control"><i class="fa fa-check"></i><b>4.1.3</b> Version control</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="workflow.html"><a href="workflow.html#setup-a-virtual-environment"><i class="fa fa-check"></i><b>4.2</b> Setup a virtual environment</a></li>
<li class="chapter" data-level="4.3" data-path="workflow.html"><a href="workflow.html#add-new-functionality"><i class="fa fa-check"></i><b>4.3</b> Add new functionality</a></li>
<li class="chapter" data-level="4.4" data-path="workflow.html"><a href="workflow.html#document"><i class="fa fa-check"></i><b>4.4</b> Document</a></li>
<li class="chapter" data-level="4.5" data-path="workflow.html"><a href="workflow.html#version-control-1"><i class="fa fa-check"></i><b>4.5</b> Version control</a></li>
<li class="chapter" data-level="4.6" data-path="workflow.html"><a href="workflow.html#example-2"><i class="fa fa-check"></i><b>4.6</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</a><ul>
<li class="chapter" data-level="4.6.1" data-path="workflow.html"><a href="workflow.html#step-1-check-package-name"><i class="fa fa-check"></i><b>4.6.1</b> Step 1: Check package name</a></li>
<li class="chapter" data-level="4.6.2" data-path="workflow.html"><a href="workflow.html#step-2-create-package-directory-and-structure"><i class="fa fa-check"></i><b>4.6.2</b> Step 2: Create package directory and structure</a></li>
<li class="chapter" data-level="4.6.3" data-path="workflow.html"><a href="workflow.html#step-3-version-control"><i class="fa fa-check"></i><b>4.6.3</b> Step 3: Version control</a></li>
<li class="chapter" data-level="4.6.4" data-path="workflow.html"><a href="workflow.html#step-4-setup-virtual-environment"><i class="fa fa-check"></i><b>4.6.4</b> Step 4: Setup virtual environment</a></li>
<li class="chapter" data-level="4.6.5" data-path="workflow.html"><a href="workflow.html#step-5-add-new-functionality"><i class="fa fa-check"></i><b>4.6.5</b> Step 5: Add new functionality</a></li>
<li class="chapter" data-level="4.6.6" data-path="workflow.html"><a href="workflow.html#step-6-document"><i class="fa fa-check"></i><b>4.6.6</b> Step 6: Document</a></li>
<li class="chapter" data-level="4.6.7" data-path="workflow.html"><a href="workflow.html#step-8-version-control"><i class="fa fa-check"></i><b>4.6.7</b> Step 8: Version control</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="workflow.html"><a href="workflow.html#example-3"><i class="fa fa-check"></i><b>4.7</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</a><ul>
<li class="chapter" data-level="4.7.1" data-path="workflow.html"><a href="workflow.html#step-1-check-package-name-1"><i class="fa fa-check"></i><b>4.7.1</b> Step 1: Check package name</a></li>
<li class="chapter" data-level="4.7.2" data-path="workflow.html"><a href="workflow.html#step-2-create-package-directory-and-structure-1"><i class="fa fa-check"></i><b>4.7.2</b> Step 2: Create package directory and structure</a></li>
<li class="chapter" data-level="4.7.3" data-path="workflow.html"><a href="workflow.html#step-3-version-control-1"><i class="fa fa-check"></i><b>4.7.3</b> Step 3: Version control</a></li>
<li class="chapter" data-level="4.7.4" data-path="workflow.html"><a href="workflow.html#step-4-setup-virtual-environment-1"><i class="fa fa-check"></i><b>4.7.4</b> Step 4: Setup virtual environment</a></li>
<li class="chapter" data-level="4.7.5" data-path="workflow.html"><a href="workflow.html#step-5-add-new-functionality-1"><i class="fa fa-check"></i><b>4.7.5</b> Step 5: Add new functionality</a></li>
<li class="chapter" data-level="4.7.6" data-path="workflow.html"><a href="workflow.html#step-6-document-1"><i class="fa fa-check"></i><b>4.7.6</b> Step 6: Document</a></li>
<li class="chapter" data-level="4.7.7" data-path="workflow.html"><a href="workflow.html#step-7-version-control"><i class="fa fa-check"></i><b>4.7.7</b> Step 7: Version control</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Package Components</b></span></li>
<li class="chapter" data-level="5" data-path="metadata.html"><a href="metadata.html"><i class="fa fa-check"></i><b>5</b> Package Metadata</a><ul>
<li class="chapter" data-level="5.1" data-path="metadata.html"><a href="metadata.html#name-and-package-description"><i class="fa fa-check"></i><b>5.1</b> Name and package description</a></li>
<li class="chapter" data-level="5.2" data-path="metadata.html"><a href="metadata.html#author-and-contact-info"><i class="fa fa-check"></i><b>5.2</b> Author and contact info</a></li>
<li class="chapter" data-level="5.3" data-path="metadata.html"><a href="metadata.html#dependencies"><i class="fa fa-check"></i><b>5.3</b> Dependencies</a></li>
<li class="chapter" data-level="5.4" data-path="metadata.html"><a href="metadata.html#versioning"><i class="fa fa-check"></i><b>5.4</b> Versioning</a></li>
<li class="chapter" data-level="5.5" data-path="metadata.html"><a href="metadata.html#license"><i class="fa fa-check"></i><b>5.5</b> License</a></li>
<li class="chapter" data-level="5.6" data-path="metadata.html"><a href="metadata.html#project-source"><i class="fa fa-check"></i><b>5.6</b> Project source</a></li>
<li class="chapter" data-level="5.7" data-path="metadata.html"><a href="metadata.html#other"><i class="fa fa-check"></i><b>5.7</b> Other</a></li>
<li class="chapter" data-level="5.8" data-path="metadata.html"><a href="metadata.html#example-4"><i class="fa fa-check"></i><b>5.8</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</a><ul>
<li class="chapter" data-level="5.8.1" data-path="metadata.html"><a href="metadata.html#dependencies-1"><i class="fa fa-check"></i><b>5.8.1</b> Dependencies</a></li>
<li class="chapter" data-level="5.8.2" data-path="metadata.html"><a href="metadata.html#exercises"><i class="fa fa-check"></i><b>5.8.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="metadata.html"><a href="metadata.html#example-5"><i class="fa fa-check"></i><b>5.9</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</a><ul>
<li class="chapter" data-level="5.9.1" data-path="metadata.html"><a href="metadata.html#dependencies-2"><i class="fa fa-check"></i><b>5.9.1</b> Dependencies</a></li>
<li class="chapter" data-level="5.9.2" data-path="metadata.html"><a href="metadata.html#exercises-1"><i class="fa fa-check"></i><b>5.9.2</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="code.html"><a href="code.html"><i class="fa fa-check"></i><b>6</b> Source Code</a><ul>
<li class="chapter" data-level="6.1" data-path="code.html"><a href="code.html#organization"><i class="fa fa-check"></i><b>6.1</b> Organization</a><ul>
<li class="chapter" data-level="6.1.1" data-path="code.html"><a href="code.html#individual-units"><i class="fa fa-check"></i><b>6.1.1</b> Individual units</a></li>
<li class="chapter" data-level="6.1.2" data-path="code.html"><a href="code.html#expanding-code-breadth"><i class="fa fa-check"></i><b>6.1.2</b> Expanding code breadth</a></li>
<li class="chapter" data-level="6.1.3" data-path="code.html"><a href="code.html#aggregating-functionality"><i class="fa fa-check"></i><b>6.1.3</b> Aggregating functionality</a></li>
<li class="chapter" data-level="6.1.4" data-path="code.html"><a href="code.html#naming-is-important"><i class="fa fa-check"></i><b>6.1.4</b> Naming is important</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="code.html"><a href="code.html#external-vs-internal"><i class="fa fa-check"></i><b>6.2</b> External vs internal</a></li>
<li class="chapter" data-level="6.3" data-path="code.html"><a href="code.html#example-6"><i class="fa fa-check"></i><b>6.3</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</a><ul>
<li class="chapter" data-level="6.3.1" data-path="code.html"><a href="code.html#setup"><i class="fa fa-check"></i><b>6.3.1</b> Setup</a></li>
<li class="chapter" data-level="6.3.2" data-path="code.html"><a href="code.html#internal-function"><i class="fa fa-check"></i><b>6.3.2</b> Internal function</a></li>
<li class="chapter" data-level="6.3.3" data-path="code.html"><a href="code.html#adding-breadth"><i class="fa fa-check"></i><b>6.3.3</b> Adding breadth</a></li>
<li class="chapter" data-level="6.3.4" data-path="code.html"><a href="code.html#adding-aggregation"><i class="fa fa-check"></i><b>6.3.4</b> Adding aggregation</a></li>
<li class="chapter" data-level="6.3.5" data-path="code.html"><a href="code.html#final-checks-version-control"><i class="fa fa-check"></i><b>6.3.5</b> Final checks &amp; version control</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="code.html"><a href="code.html#example-7"><i class="fa fa-check"></i><b>6.4</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</a><ul>
<li class="chapter" data-level="6.4.1" data-path="code.html"><a href="code.html#setup-1"><i class="fa fa-check"></i><b>6.4.1</b> Setup</a></li>
<li class="chapter" data-level="6.4.2" data-path="code.html"><a href="code.html#internal-function-1"><i class="fa fa-check"></i><b>6.4.2</b> Internal function</a></li>
<li class="chapter" data-level="6.4.3" data-path="code.html"><a href="code.html#adding-breadth-1"><i class="fa fa-check"></i><b>6.4.3</b> Adding breadth</a></li>
<li class="chapter" data-level="6.4.4" data-path="code.html"><a href="code.html#adding-aggregation-1"><i class="fa fa-check"></i><b>6.4.4</b> Adding aggregation</a></li>
<li class="chapter" data-level="6.4.5" data-path="code.html"><a href="code.html#simplify-user-access"><i class="fa fa-check"></i><b>6.4.5</b> Simplify user access</a></li>
<li class="chapter" data-level="6.4.6" data-path="code.html"><a href="code.html#final-checks-version-control-1"><i class="fa fa-check"></i><b>6.4.6</b> Final checks &amp; version control</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="test.html"><a href="test.html"><i class="fa fa-check"></i><b>7</b> Testing</a><ul>
<li class="chapter" data-level="7.1" data-path="test.html"><a href="test.html#why-test"><i class="fa fa-check"></i><b>7.1</b> Why test</a></li>
<li class="chapter" data-level="7.2" data-path="test.html"><a href="test.html#what-to-test"><i class="fa fa-check"></i><b>7.2</b> What to test</a></li>
<li class="chapter" data-level="7.3" data-path="test.html"><a href="test.html#test-organization"><i class="fa fa-check"></i><b>7.3</b> Test organization</a></li>
<li class="chapter" data-level="7.4" data-path="test.html"><a href="test.html#types-of-tests"><i class="fa fa-check"></i><b>7.4</b> Types of tests</a></li>
<li class="chapter" data-level="7.5" data-path="test.html"><a href="test.html#writing-tests"><i class="fa fa-check"></i><b>7.5</b> Writing tests</a></li>
<li class="chapter" data-level="7.6" data-path="test.html"><a href="test.html#additional-resources"><i class="fa fa-check"></i><b>7.6</b> Additional resources</a></li>
<li class="chapter" data-level="7.7" data-path="test.html"><a href="test.html#example-8"><i class="fa fa-check"></i><b>7.7</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</a><ul>
<li class="chapter" data-level="7.7.1" data-path="test.html"><a href="test.html#test-organization-1"><i class="fa fa-check"></i><b>7.7.1</b> Test organization</a></li>
<li class="chapter" data-level="7.7.2" data-path="test.html"><a href="test.html#writing-a-test"><i class="fa fa-check"></i><b>7.7.2</b> Writing a test</a></li>
<li class="chapter" data-level="7.7.3" data-path="test.html"><a href="test.html#what-to-test-1"><i class="fa fa-check"></i><b>7.7.3</b> What to test</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="test.html"><a href="test.html#example-9"><i class="fa fa-check"></i><b>7.8</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</a><ul>
<li class="chapter" data-level="7.8.1" data-path="test.html"><a href="test.html#test-organization-2"><i class="fa fa-check"></i><b>7.8.1</b> Test organization</a></li>
<li class="chapter" data-level="7.8.2" data-path="test.html"><a href="test.html#writing-a-test-1"><i class="fa fa-check"></i><b>7.8.2</b> Writing a test</a></li>
<li class="chapter" data-level="7.8.3" data-path="test.html"><a href="test.html#what-to-test-2"><i class="fa fa-check"></i><b>7.8.3</b> What to test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="object-docs.html"><a href="object-docs.html"><i class="fa fa-check"></i><b>8</b> Object Documentation</a><ul>
<li class="chapter" data-level="8.1" data-path="object-docs.html"><a href="object-docs.html#example-10"><i class="fa fa-check"></i><b>8.1</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</a><ul>
<li class="chapter" data-level="8.1.1" data-path="object-docs.html"><a href="object-docs.html#package-level-documentation"><i class="fa fa-check"></i><b>8.1.1</b> Package-level documentation</a></li>
<li class="chapter" data-level="8.1.2" data-path="object-docs.html"><a href="object-docs.html#module-level-documentation"><i class="fa fa-check"></i><b>8.1.2</b> Module-level documentation</a></li>
<li class="chapter" data-level="8.1.3" data-path="object-docs.html"><a href="object-docs.html#function-level-documentation"><i class="fa fa-check"></i><b>8.1.3</b> Function-level documentation</a></li>
<li class="chapter" data-level="8.1.4" data-path="object-docs.html"><a href="object-docs.html#additional-syntax"><i class="fa fa-check"></i><b>8.1.4</b> Additional syntax</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="object-docs.html"><a href="object-docs.html#example-11"><i class="fa fa-check"></i><b>8.2</b> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="changelog.html"><a href="changelog.html"><i class="fa fa-check"></i><b>9</b> Changelog</a></li>
<li class="chapter" data-level="10" data-path="readme.html"><a href="readme.html"><i class="fa fa-check"></i><b>10</b> README</a></li>
<li class="chapter" data-level="11" data-path="website.html"><a href="website.html"><i class="fa fa-check"></i><b>11</b> Package Website</a></li>
<li class="chapter" data-level="12" data-path="metadata.html"><a href="metadata.html#other"><i class="fa fa-check"></i><b>12</b> Other Components</a></li>
<li class="part"><span><b>III Continuous Integration &amp; Deployment</b></span></li>
<li class="chapter" data-level="13" data-path="tbd.html"><a href="tbd.html"><i class="fa fa-check"></i><b>13</b> TBD</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Delivering Data Science Products via Packages</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="test" class="section level1">
<h1><span class="header-section-number">7</span> Testing</h1>
<p>Testing is a vital part of package development. It ensures that your code does what you want it to do. Although testing adds an additional step to your development workflow, it should not be overlooked. The goal of this chapter is to discuss the fundamentals of testing; however, this is a very cursory overview so we provide additional resources to learn more.</p>
<div id="why-test" class="section level2">
<h2><span class="header-section-number">7.1</span> Why test</h2>
<p>Often when we start writing a package our instinct is to write a function, experiment with it in the console to see if it works, rinse and repeat until we have a solution we’re happy with. While this is <em>“testing”</em> your code, you’re only doing it informally. The problem with this approach is that when you come back to this code in 3 months time to add a new feature, you’ve probably forgotten some of the informal tests you ran the first time around. This makes it very easy to break code that used to work.</p>
<p>Formalizing and automating the test structure and process helps with:</p>
<ul>
<li><p><strong>Fewer bugs</strong>. Because you’re explicit about how your code should behave you will have fewer bugs. The reason why is a bit like the reason double entry book-keeping works: because you describe the behaviour of your code in two places, both in your code and in your tests, you are able to check one against the other. By following this approach to testing, you can be sure that bugs that you’ve fixed in the past will never come back to haunt you.</p></li>
<li><p><strong>Better code structure</strong>. Code that’s easy to test is usually better designed. This is because writing tests forces you to break up complicated parts of your code into separate functions that can work in isolation. This reduces duplication in your code. As a result, functions will be easier to test, understand and work with (it’ll be easier to combine them in new ways).</p></li>
<li><p><strong>Easier restarts</strong>. If you always finish a coding session by creating a failing test (e.g. for the next feature you want to implement), testing makes it easier for you to pick up where you left off: your tests will let you know what to do next.</p></li>
<li><p><strong>Robust code</strong>. If you know that all the major functionality of your package has an associated test, you can confidently make big changes without worrying about accidentally breaking something. For me, this is particularly useful when I think I have a simpler way to accomplish a task (usually the reason my solution is simpler is that I’ve forgotten an important use case!).</p></li>
</ul>
</div>
<div id="what-to-test" class="section level2">
<h2><span class="header-section-number">7.2</span> What to test</h2>
<p>There is a fine balance to writing tests. Each test that you write makes your code less likely to change inadvertently; but it also can make it harder to change your code on purpose. It’s hard to give good general advice about writing tests, but you might find these points helpful:</p>
<ul>
<li><p>Focus on testing the external interface to your functions - if you test the internal interface, then it’s harder to change the implementation in the future because as well as modifying the code, you’ll also need to update all the tests.</p></li>
<li><p>Strive to test each behaviour in one and only one test. Then if that behavior later changes you only need to update a single test.</p></li>
<li><p>You do not need to test <em>all</em> of your code; however, we often strive to test 85-95% of our code. Focus your time on code that you’re not sure about, is fragile, or has complicated interdependencies. That said, we often find we make the most mistakes when we falsely assume that the problem is simple and doesn’t need any tests. So there is definitely a case for striving for 100% coverage.</p></li>
<li><p>Always write a test when you discover a bug or want to create a feature enhancement. Start by writing the tests, and then write the code that makes them pass. This reflects an important problem solving strategy: start by establishing your success criteria, how you know if you’ve solved the problem.</p></li>
<li><p>You should not only write tests that outline the successful expected outcome of a function but you should also write tests to verify that expected messages, warnings, and errors are produced.</p></li>
</ul>
</div>
<div id="test-organization" class="section level2">
<h2><span class="header-section-number">7.3</span> Test organization</h2>
<p>For both <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> and <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> packages the tests should live in a <code>tests/</code> directory at the root of the package. The test files for both languages should start with <code>test</code> (i.e. <code>test-validation.R</code>, <code>test_summary_stats.py</code>). Within the <code>tests/</code> directory there are some differences between the two languages and we will discuss that in the example sections.</p>
<p>Tests are organized hierarchically: expectations and assertions are grouped into tests which are organized in files:</p>
<ul>
<li><p>An <strong>expectation</strong> or <strong>assertion</strong> is the atom of testing. It describes the expected result of a computation: Does it have the right value and right class? Does it produce error messages when it should? An expectation automates visual checking of results in the console.</p></li>
<li><p>A <strong>test</strong> groups together one or more expectations/assertions to test the output from a simple function, a range of possibilities for a single parameter from a more complicated function, or tightly related functionality from across multiple functions. This is why they are sometimes called unit as they test one unit of functionality.</p></li>
<li><p>A <strong>test file</strong> groups together multiple related tests. How you organize tests within files is your discretion; however, one best practice suggests that for every source code script there is a companion, similarly named test script (i.e. <code>summary_stats.py</code> &amp; <code>test_summary_stats.py</code>).</p></li>
</ul>
</div>
<div id="types-of-tests" class="section level2">
<h2><span class="header-section-number">7.4</span> Types of tests</h2>
<p>There are many types of tests that you will read about when diving into the software test literature; however, the most common ones you should be thinking of initially are:</p>
<ul>
<li><p><strong>unit tests</strong>: Tests that focus on the output from a single function, typically functions with lower levels of abstraction. Unit tests typically test the foundational building block functions of your package. This is why they are sometimes called unit as they test one unit of functionality. Unit tests should be fast so you can run them often and, preferablly not require any special environment to run them (i.e. a Spark session). Examples in our prototype package include the tests for <code>my_mean()</code> and <code>my_sd()</code>.</p></li>
<li><p><strong>integration tests</strong>: Tests that focus on processes and/or components that combine functionality from across multiple functions. As you build higher levels of abstraction, most of the underlying functionality of this abstraction is already tested with unit tests; however, the integration tests ensure that all the lower abstraction level functions work nicely with one another when combined. An example of an integration test in our prototype package is the test for the <code>z_score()</code> function.
Often, integrated functionality becomes very large and sometimes can be slower to compute so it is not unusual for integration tests to be much slower than unit tests. However, we also do not need to run them as often as unit tests.</p></li>
</ul>
</div>
<div id="writing-tests" class="section level2">
<h2><span class="header-section-number">7.5</span> Writing tests</h2>
<p>Writing good tests takes time. It is not uncommon for people to write tests that are unfocused or too broad when first learning about software testing. Also, many people do not document their tests in a comprehensive way. This can lead to you coming back to a test in 3 months, when it does fail, scratching your head wondering what you were trying to do with the test.</p>
<p><strong>Given-When-Then</strong> is a style of representing tests that can help guide you in writing your tests, make your tests more focused and better documented. The essential idea is to break down writing a scenario (or test) into three sections:</p>
<ul>
<li>The <strong>given</strong> part describes the state of the world before you begin the behavior you’re specifying in this scenario. You can think of it as the pre-conditions to the test.</li>
<li>The <strong>when</strong> section is the behavior that you’re specifying, or the specific functionality you are applying to the given state of the world.</li>
<li>Finally the <strong>then</strong> section describes the changes you expect due to the specified behavior.</li>
</ul>
<p>A simple example is with our <code>my_mean()</code> function. In both languages we follow a common procedure:</p>
<ol style="list-style-type: decimal">
<li><strong>GIVEN</strong> a vector or list of integers from 0-10,</li>
<li><strong>WHEN</strong> we compute the mean value,</li>
<li><strong>THEN</strong> the result should be 5</li>
</ol>
<p>Following this basic guide will make writing tests more explicit, easier, and better documented.</p>
</div>
<div id="additional-resources" class="section level2">
<h2><span class="header-section-number">7.6</span> Additional resources</h2>
<p>Software testing is far too comprehensive to cover in one chapter. The above sections provide good foundations for your testing methodology and the <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> and <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> sections that follow will show a few more details about actual implementation. However, if you want to learn more about testing we recommend the following:</p>
<ul>
<li>Build your knowledge of general software testing philosophies:
<ul>
<li><a href="https://www.amazon.com/Pragmatic-Programmer-journey-mastery-Anniversary/dp/0135957052/ref=dp_ob_title_bk">The Pragramatic Programmer</a> (Ch. 41)</li>
<li><a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882/ref=pd_bxgy_img_2/134-3713013-8748161?_encoding=UTF8&amp;pd_rd_i=0132350882&amp;pd_rd_r=c66a8eb8-13a3-4246-bf5c-47bff29f3be6&amp;pd_rd_w=m2kCB&amp;pd_rd_wg=NqeJv&amp;pf_rd_p=4e3f7fc3-00c8-46a6-a4db-8457e6319578&amp;pf_rd_r=R46745MCZ1C0V1ZD3QS4&amp;psc=1&amp;refRID=R46745MCZ1C0V1ZD3QS4">Clean Code</a> (Ch. 9)</li>
<li><a href="https://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530">Test Driven Development</a></li>
</ul></li>
<li>Learn more about implementing software testing in <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> and <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg>:
<ul>
<li><a href="https://www.amazon.com/Testing-Code-Chapman-Hall-CRC/dp/1498763650">Testing R Code</a></li>
<li><a href="https://testthat.r-lib.org/">testthat documentation</a></li>
<li><a href="https://www.amazon.com/Python-Testing-pytest-Effective-Scalable/dp/1680502409/ref=sr_1_3?keywords=Python+Testing+with+pytest&amp;qid=1578174634&amp;s=books&amp;sr=1-3">Python Testing with pytest</a></li>
<li><a href="https://us.pycon.org/2020/schedule/presentation/172/">Multiply your Testing Effectiveness with Parameterized Testing</a></li>
<li><a href="https://docs.pytest.org/en/latest/">pytest documentation</a></li>
</ul></li>
</ul>
</div>
<div id="example-8" class="section level2">
<h2><span class="header-section-number">7.7</span> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> example</h2>
<p>The most common testing framework in <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> is the <a href="https://github.com/r-lib/testthat/">testthat</a> package.</p>
<div id="test-organization-1" class="section level3">
<h3><span class="header-section-number">7.7.1</span> Test organization</h3>
<p>The <code>test/</code> directory in an <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 581 512"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> should have the following:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="ex">.</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2">└── <span class="ex">tests</span></a>
<a class="sourceLine" id="cb91-3" data-line-number="3">    └── <span class="ex">testthat</span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4">        ├── <span class="ex">test-script1.R</span></a>
<a class="sourceLine" id="cb91-5" data-line-number="5">        ├── <span class="ex">test-script2.R</span></a>
<a class="sourceLine" id="cb91-6" data-line-number="6">        └── <span class="ex">test-scriptn.R</span></a></code></pre></div>
<p>…where all test scripts start with <code>test</code> and fall in a <code>tests/testhat/</code> directory. This is automatically set up for you in our template but you can easily create this from scratch with <code>usethis::use_testthat()</code>. When using this approach, each test script should be considered isolated from one another. If for some reason you need to create an object, environment or connection that gets used across multiple test files then you will see the following structure where objects, environments or connections are created in the <code>setup.R</code> file and then, if necessary, decommissioned/disconnected in the <code>teardown.R</code> file.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="ex">.</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2">└── <span class="ex">tests</span></a>
<a class="sourceLine" id="cb92-3" data-line-number="3">    └── <span class="ex">testthat</span></a>
<a class="sourceLine" id="cb92-4" data-line-number="4">        ├── <span class="ex">setup.R</span></a>
<a class="sourceLine" id="cb92-5" data-line-number="5">        ├── <span class="ex">test-script1.R</span></a>
<a class="sourceLine" id="cb92-6" data-line-number="6">        ├── <span class="ex">test-script2.R</span></a>
<a class="sourceLine" id="cb92-7" data-line-number="7">        ├── <span class="ex">test-scriptn.R</span></a>
<a class="sourceLine" id="cb92-8" data-line-number="8">        └── <span class="ex">teardown.R</span></a></code></pre></div>
<div class="warning">
<p>
Test scripts are ran in order based on their name. So if you need, or desire, to run tests in a specific order than name them in an orderly fashion:
</p>
<ul>
<li>
<code>test-01-name1.R</code>
</li>
<li>
<code>test-02-name2.R</code>
</li>
<li>
<code>test-03-name3.R</code>
</li>
</ul>
</div>
</div>
<div id="writing-a-test" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Writing a test</h3>
<p>We write tests in the following approach where:</p>
<ul>
<li><code>test_that()</code> captures a suite of expectations,</li>
<li><code>&quot;test context&quot;</code> provides a clear, concise explanation of the purpose of the test,</li>
<li>we can include any additional documentation in comments</li>
<li>and <code>expect_xxx()</code> is the expectation we have for our test output. There are a variety of <code>expect_xxx()</code> functions that we can apply (i.e. <code>expect_equal</code>, )</li>
</ul>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;test context&quot;</span>, {</a>
<a class="sourceLine" id="cb93-2" data-line-number="2">   <span class="co"># additional documentation</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3">   <span class="kw">expect_xxx</span>()</a>
<a class="sourceLine" id="cb93-4" data-line-number="4">})</a></code></pre></div>
<div class="tip">
<p>
There are a variety of <code>expect_xxx()</code> functions that we can apply (i.e. <code>expect_equal</code>, <code>expect_length</code>, <code>expect_failure</code>, <code>expect_message</code>).
</p>
<p>
Type <code>testthat::expect_</code> + tab in your console to see all the options.
</p>
</div>
<p>Let’s take a look at our current <code>test-validation.R</code> file:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;inputs are a numeric vector&quot;</span>, {</a>
<a class="sourceLine" id="cb94-2" data-line-number="2">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="st">&quot;a&quot;</span>))</a>
<a class="sourceLine" id="cb94-3" data-line-number="3">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="kw">factor</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb94-4" data-line-number="4">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb94-5" data-line-number="5"></a>
<a class="sourceLine" id="cb94-6" data-line-number="6">  <span class="kw">expect_silent</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb94-7" data-line-number="7">  <span class="kw">expect_silent</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb94-8" data-line-number="8">})</a></code></pre></div>
<p>This test is currently a catch-all for our <code>validate_numeric_vector()</code> function. A better approach would be to break this up into specific functionality such as:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;non-vector inputs raise error&quot;</span>, {</a>
<a class="sourceLine" id="cb95-2" data-line-number="2">  <span class="co"># GIVEN a non-atomic vector input</span></a>
<a class="sourceLine" id="cb95-3" data-line-number="3">  <span class="co"># WHEN validating said input</span></a>
<a class="sourceLine" id="cb95-4" data-line-number="4">  <span class="co"># THEN an error is raised</span></a>
<a class="sourceLine" id="cb95-5" data-line-number="5">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb95-6" data-line-number="6">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb95-7" data-line-number="7">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb95-8" data-line-number="8">})</a>
<a class="sourceLine" id="cb95-9" data-line-number="9"></a>
<a class="sourceLine" id="cb95-10" data-line-number="10"><span class="kw">test_that</span>(<span class="st">&quot;non-numeric vectors raise error&quot;</span>, {</a>
<a class="sourceLine" id="cb95-11" data-line-number="11">  <span class="co"># GIVEN a vector input</span></a>
<a class="sourceLine" id="cb95-12" data-line-number="12">  <span class="co"># WHEN the vector is not numeric</span></a>
<a class="sourceLine" id="cb95-13" data-line-number="13">  <span class="co"># THEN an error is raised</span></a>
<a class="sourceLine" id="cb95-14" data-line-number="14">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="st">&quot;a&quot;</span>))</a>
<a class="sourceLine" id="cb95-15" data-line-number="15">  <span class="kw">expect_error</span>(<span class="kw">validate_numeric_vector</span>(<span class="kw">factor</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb95-16" data-line-number="16">})</a>
<a class="sourceLine" id="cb95-17" data-line-number="17"></a>
<a class="sourceLine" id="cb95-18" data-line-number="18"><span class="kw">test_that</span>(<span class="st">&quot;atomic vectors with numeric data are silent&quot;</span>, {</a>
<a class="sourceLine" id="cb95-19" data-line-number="19">  <span class="co"># GIVEN an atomic vector input</span></a>
<a class="sourceLine" id="cb95-20" data-line-number="20">  <span class="co"># WHEN the vector contains numeric values or logical that can be coerced to numeric</span></a>
<a class="sourceLine" id="cb95-21" data-line-number="21">  <span class="co"># THEN a silent return occurs</span></a>
<a class="sourceLine" id="cb95-22" data-line-number="22">  <span class="kw">expect_silent</span>(<span class="kw">c</span>(<span class="fl">1.0</span>, <span class="fl">2.0</span>, <span class="fl">3.0</span>))</a>
<a class="sourceLine" id="cb95-23" data-line-number="23">  <span class="kw">expect_silent</span>(<span class="kw">c</span>(1L, 2L, 3L))</a>
<a class="sourceLine" id="cb95-24" data-line-number="24">  <span class="kw">expect_silent</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>))</a>
<a class="sourceLine" id="cb95-25" data-line-number="25">})</a></code></pre></div>
<p>The above is a little more explicit and methodical regarding what we expect to occur. If you run the above tests, you will actually see that a failure occurs. This is because a <code>matrix</code> technically is an atomic vector. We’ve found an edge case in our testing that we either need to decide to relax our unit test (if we are okay with a user supplying a matrix) or make our <code>validate_numeric_vector</code> function more robust to deal with matrix inputs.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">test</span>()</a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="co">## Loading myfirstpkg</span></a>
<a class="sourceLine" id="cb96-3" data-line-number="3"><span class="co">## Testing myfirstpkg</span></a>
<a class="sourceLine" id="cb96-4" data-line-number="4"><span class="co">## ✓ |  OK F W S | Context</span></a>
<a class="sourceLine" id="cb96-5" data-line-number="5"><span class="co">## ✓ |   3       | summary-stats</span></a>
<a class="sourceLine" id="cb96-6" data-line-number="6"><span class="co">## x |   7 1     | validation</span></a>
<a class="sourceLine" id="cb96-7" data-line-number="7"><span class="co">## ───────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb96-8" data-line-number="8"><span class="co">## test-validation.R:5: failure: non-vector inputs raise error</span></a>
<a class="sourceLine" id="cb96-9" data-line-number="9"><span class="co">## `validate_numeric_vector(matrix(1:3))` did not throw an error.</span></a>
<a class="sourceLine" id="cb96-10" data-line-number="10"><span class="co">## ───────────────────────────────────────────────────────────────────────────────────────────────</span></a>
<a class="sourceLine" id="cb96-11" data-line-number="11"><span class="co">## </span></a>
<a class="sourceLine" id="cb96-12" data-line-number="12"><span class="co">## ══ Results ════════════════════════════════════════════════════════════════════════════════════</span></a>
<a class="sourceLine" id="cb96-13" data-line-number="13"><span class="co">## OK:       10</span></a>
<a class="sourceLine" id="cb96-14" data-line-number="14"><span class="co">## Failed:   1</span></a>
<a class="sourceLine" id="cb96-15" data-line-number="15"><span class="co">## Warnings: 0</span></a>
<a class="sourceLine" id="cb96-16" data-line-number="16"><span class="co">## Skipped:  0</span></a></code></pre></div>
<p>This brings up the topic of what exactly we should be testing.</p>
</div>
<div id="what-to-test-1" class="section level3">
<h3><span class="header-section-number">7.7.3</span> What to test</h3>
<p>This is a much harder concept to answer. We can certainly go over-board with testing if we try to capture every possible scenario. Our general approach is to test the main use-cases and then add to our test suite down the road as edge cases pop up.</p>
<p>Defining the main use-cases is not always easy. We typically look for:</p>
<ul>
<li>a couple basic uses cases that we feel the vast majority of users will apply,</li>
<li>a few expected edge cases such as if user supply <code>NA</code> or <code>Inf</code> values or if there are upper limits to the expected inputs (what if a user supplies an interest rate parameter with a negative value or value greater than 100%),</li>
<li>expected messages, warnings, or errors designed specific for end-users.</li>
</ul>
<p>For example, our current test for our <code>my_mean()</code> function provides a very basic use case:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;mean of simple vector computes accurately&quot;</span>, {</a>
<a class="sourceLine" id="cb97-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb97-3" data-line-number="3">  <span class="kw">expect_equal</span>(<span class="kw">my_mean</span>(x), <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb97-4" data-line-number="4">})</a></code></pre></div>
<p>We would likely want to expand this initially to capture a few expected scenarios. The below provides three distinct test purposes for our <code>my_mean()</code> function. If you run the following you will see that the second test fails because our original implementation does not handle <code>NA</code>, <code>Inf</code> or <code>Nan</code> values. We would need to go back to that function and update it to deail with those values.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw">test_that</span>(<span class="st">&quot;mean of numeric vectors compute accurately&quot;</span>, {</a>
<a class="sourceLine" id="cb98-2" data-line-number="2">  <span class="co"># GIVEN a vector input</span></a>
<a class="sourceLine" id="cb98-3" data-line-number="3">  <span class="co"># WHEN the data values are numeric or logical</span></a>
<a class="sourceLine" id="cb98-4" data-line-number="4">  <span class="co"># THEN an arithmetic mean should be computed</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5">  integer_inputs &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb98-6" data-line-number="6">  float_inputs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>)</a>
<a class="sourceLine" id="cb98-7" data-line-number="7">  logical_inputs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb98-8" data-line-number="8">  negative_inputs &lt;-<span class="st"> </span><span class="dv">-10</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb98-9" data-line-number="9"></a>
<a class="sourceLine" id="cb98-10" data-line-number="10">  <span class="kw">expect_equal</span>(<span class="kw">my_mean</span>(integer_inputs), <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb98-11" data-line-number="11">  <span class="kw">expect_equal</span>(<span class="kw">my_mean</span>(float_inputs), <span class="fl">2.5</span>)</a>
<a class="sourceLine" id="cb98-12" data-line-number="12">  <span class="kw">expect_equal</span>(<span class="kw">my_mean</span>(negative_inputs), <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb98-13" data-line-number="13">})</a>
<a class="sourceLine" id="cb98-14" data-line-number="14"></a>
<a class="sourceLine" id="cb98-15" data-line-number="15"><span class="kw">test_that</span>(<span class="st">&quot;Inf, NaN, and NA values are ignored&quot;</span>, {</a>
<a class="sourceLine" id="cb98-16" data-line-number="16">  <span class="co"># GIVEN a vector input that contains numeric values</span></a>
<a class="sourceLine" id="cb98-17" data-line-number="17">  <span class="co"># WHEN the vector also contains Inf, NaN, and NA values</span></a>
<a class="sourceLine" id="cb98-18" data-line-number="18">  <span class="co"># THEN these irregular values should be stripped and the arithmetic mean computed</span></a>
<a class="sourceLine" id="cb98-19" data-line-number="19">  x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">NA</span>, <span class="ot">Inf</span>, <span class="ot">NaN</span>)</a>
<a class="sourceLine" id="cb98-20" data-line-number="20">  <span class="kw">expect_equal</span>(<span class="kw">my_mean</span>(x), <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb98-21" data-line-number="21">})</a>
<a class="sourceLine" id="cb98-22" data-line-number="22"></a>
<a class="sourceLine" id="cb98-23" data-line-number="23"><span class="kw">test_that</span>(<span class="st">&quot;Inadequate inputs raise error&quot;</span>, {</a>
<a class="sourceLine" id="cb98-24" data-line-number="24">  <span class="co"># GIVEN a user input</span></a>
<a class="sourceLine" id="cb98-25" data-line-number="25">  <span class="co"># WHEN the input is not a vector with numeric values</span></a>
<a class="sourceLine" id="cb98-26" data-line-number="26">  <span class="co"># THEN an error should be raised</span></a>
<a class="sourceLine" id="cb98-27" data-line-number="27">  <span class="kw">expect_error</span>(<span class="kw">my_mean</span>(<span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb98-28" data-line-number="28">  <span class="kw">expect_error</span>(<span class="kw">my_mean</span>(<span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb98-29" data-line-number="29">  <span class="kw">expect_error</span>(<span class="kw">my_mean</span>(<span class="st">&quot;a&quot;</span>))</a>
<a class="sourceLine" id="cb98-30" data-line-number="30">  <span class="kw">expect_error</span>(<span class="kw">my_mean</span>(<span class="kw">factor</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb98-31" data-line-number="31">})</a></code></pre></div>
</div>
</div>
<div id="example-9" class="section level2">
<h2><span class="header-section-number">7.8</span> <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> example</h2>
<p>The most common testing framework in <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> is the <a href="https://docs.pytest.org/en/latest/">pytest</a> package.</p>
<div id="test-organization-2" class="section level3">
<h3><span class="header-section-number">7.8.1</span> Test organization</h3>
<p>The <code>test/</code> directory in an <svg style="height:0.8em;top:.04em;position:relative;" viewBox="0 0 448 512"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> should have the following:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="ex">.</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2">└── <span class="ex">tests</span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3">    ├── <span class="ex">__init__.py</span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4">    ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb99-5" data-line-number="5">    ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb99-6" data-line-number="6">    └── <span class="ex">test-scriptn.py</span></a></code></pre></div>
<p>…where all test scripts start with <code>test</code>. The <strong>init</strong>.py file is not necessary but it allows you to have duplicate file and test names without causing namespace clashes. This is especially helpful when you have multiple test directories. For example, we commonly group our tests in the following manner for larger packages where all unit tests go in one directory and all integration tests go in another.</p>
<div class="tip">
<p>
This allows you to easily test a single directory at a time with <code>pytest tests/unit</code>.
</p>
</div>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="ex">.</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2">└── <span class="ex">tests</span></a>
<a class="sourceLine" id="cb100-3" data-line-number="3">    ├── <span class="ex">unit</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4">    │   ├── <span class="ex">__init__.py</span></a>
<a class="sourceLine" id="cb100-5" data-line-number="5">    │   ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb100-6" data-line-number="6">    │   ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb100-7" data-line-number="7">    │   └── <span class="ex">test-scriptn.py</span></a>
<a class="sourceLine" id="cb100-8" data-line-number="8">    └── <span class="ex">integration</span></a>
<a class="sourceLine" id="cb100-9" data-line-number="9">        ├── <span class="ex">__init__.py</span></a>
<a class="sourceLine" id="cb100-10" data-line-number="10">        ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb100-11" data-line-number="11">        ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb100-12" data-line-number="12">        └── <span class="ex">test-scriptn.py</span></a></code></pre></div>
<p>If for some reason you need to create an object, environment or connection that gets used across multiple test files then you will see the following structure where objects, environments or connections are created in the <code>conftest.py</code> file, supplied to individual tests with a <a href="https://pybit.es/pytest-fixtures.html">test fixture</a>, and then decommissioned/disconnected thereafter.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="ex">.</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2">└── <span class="ex">tests</span></a>
<a class="sourceLine" id="cb101-3" data-line-number="3">    ├── <span class="ex">__init__.py</span></a>
<a class="sourceLine" id="cb101-4" data-line-number="4">    ├── <span class="ex">conftest.py</span></a>
<a class="sourceLine" id="cb101-5" data-line-number="5">    ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb101-6" data-line-number="6">    ├── <span class="ex">test_script1.py</span></a>
<a class="sourceLine" id="cb101-7" data-line-number="7">    └── <span class="ex">test-scriptn.py</span></a>
<a class="sourceLine" id="cb101-8" data-line-number="8"><span class="ex">...</span></a></code></pre></div>
<div class="warning">
<p>
Test scripts are ran in order based on their name. So if you need, or desire, to run tests in a specific order than name them in an orderly fashion:
</p>
<ul>
<li>
<code>test_01_name1.py</code>
</li>
<li>
<code>test_02_name2.py</code>
</li>
<li>
<code>test_03_name3.py</code>
</li>
</ul>
</div>
</div>
<div id="writing-a-test-1" class="section level3">
<h3><span class="header-section-number">7.8.2</span> Writing a test</h3>
<p>We write tests in the following approach where:</p>
<ul>
<li><code>def test_name_of_test()</code> creates a test function that captures a suite of assertions,</li>
<li>The test function docstring provides a clear, concise explanation of the purpose of the test,</li>
<li>and <code>assert</code> is the assertion we have for our test output.</li>
</ul>
<div class="sourceCode" id="cb102"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">def</span> test_name_of_test():</a>
<a class="sourceLine" id="cb102-2" data-line-number="2">   <span class="co">&quot;&quot;&quot;Test docstring</span></a>
<a class="sourceLine" id="cb102-3" data-line-number="3"><span class="co">   GIVEN ...</span></a>
<a class="sourceLine" id="cb102-4" data-line-number="4"><span class="co">   WHEN ...</span></a>
<a class="sourceLine" id="cb102-5" data-line-number="5"><span class="co">   THEN ...</span></a>
<a class="sourceLine" id="cb102-6" data-line-number="6"><span class="co">   &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb102-7" data-line-number="7">   <span class="cf">assert</span> computed <span class="op">==</span> expected</a></code></pre></div>
<div class="tip">
<p>
Apart from <code>assert</code>, we can also test for exceptions, warning messages and the like with syntax such as <code>with pytest.raises(TypeError):</code>. We’ll demonstrate this shortly.
</p>
</div>
<p>Let’s take a look at our current <code>test_validation.py</code> file:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">def</span> test_validate_sequence_type():</a>
<a class="sourceLine" id="cb103-2" data-line-number="2">    <span class="cf">with</span> pytest.raises(<span class="pp">TypeError</span>):</a>
<a class="sourceLine" id="cb103-3" data-line-number="3">        _validate_numeric_sequence({})</a>
<a class="sourceLine" id="cb103-4" data-line-number="4"></a>
<a class="sourceLine" id="cb103-5" data-line-number="5"><span class="kw">def</span> test_validate_sequence_numeric():</a>
<a class="sourceLine" id="cb103-6" data-line-number="6">    <span class="cf">assert</span> _validate_numeric_sequence(<span class="bu">range</span>(<span class="dv">10</span>)) <span class="op">==</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb103-7" data-line-number="7">    <span class="cf">with</span> pytest.raises(<span class="pp">TypeError</span>):</a>
<a class="sourceLine" id="cb103-8" data-line-number="8">        _validate_numeric_sequence(<span class="bu">list</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>))</a></code></pre></div>
<p>A better approach would be to break this up into specific functionality and create appropriate docstrings:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb104-1" data-line-number="1"><span class="kw">def</span> test_validate_sequence_type():</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">    <span class="co">&quot;&quot;&quot;Non-sequence data type raises exception.</span></a>
<a class="sourceLine" id="cb104-3" data-line-number="3"></a>
<a class="sourceLine" id="cb104-4" data-line-number="4"><span class="co">    GIVEN a non-sequence input</span></a>
<a class="sourceLine" id="cb104-5" data-line-number="5"></a>
<a class="sourceLine" id="cb104-6" data-line-number="6"><span class="co">    WHEN validating said input</span></a>
<a class="sourceLine" id="cb104-7" data-line-number="7"></a>
<a class="sourceLine" id="cb104-8" data-line-number="8"><span class="co">    THEN an error is raised</span></a>
<a class="sourceLine" id="cb104-9" data-line-number="9"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb104-10" data-line-number="10">    <span class="cf">with</span> pytest.raises(<span class="pp">TypeError</span>):</a>
<a class="sourceLine" id="cb104-11" data-line-number="11">        _validate_numeric_sequence({})</a>
<a class="sourceLine" id="cb104-12" data-line-number="12">        _validate_numeric_sequence(<span class="bu">set</span>())</a>
<a class="sourceLine" id="cb104-13" data-line-number="13"></a>
<a class="sourceLine" id="cb104-14" data-line-number="14"><span class="kw">def</span> test_validate_non_numeric_sequence():</a>
<a class="sourceLine" id="cb104-15" data-line-number="15">    <span class="co">&quot;&quot;&quot;Non-numeric sequence raises error</span></a>
<a class="sourceLine" id="cb104-16" data-line-number="16"></a>
<a class="sourceLine" id="cb104-17" data-line-number="17"><span class="co">    GIVEN a sequence input</span></a>
<a class="sourceLine" id="cb104-18" data-line-number="18"></a>
<a class="sourceLine" id="cb104-19" data-line-number="19"><span class="co">    WHEN the sequence is not numeric</span></a>
<a class="sourceLine" id="cb104-20" data-line-number="20"></a>
<a class="sourceLine" id="cb104-21" data-line-number="21"><span class="co">    THEN an error is raised</span></a>
<a class="sourceLine" id="cb104-22" data-line-number="22"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb104-23" data-line-number="23">    <span class="cf">with</span> pytest.raises(<span class="pp">TypeError</span>):</a>
<a class="sourceLine" id="cb104-24" data-line-number="24">        _validate_numeric_sequence(<span class="bu">list</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>))</a>
<a class="sourceLine" id="cb104-25" data-line-number="25"></a>
<a class="sourceLine" id="cb104-26" data-line-number="26"><span class="kw">def</span> test_validate_sequence_numeric():</a>
<a class="sourceLine" id="cb104-27" data-line-number="27">    <span class="co">&quot;&quot;&quot;Sequence with numeric data returns None</span></a>
<a class="sourceLine" id="cb104-28" data-line-number="28"></a>
<a class="sourceLine" id="cb104-29" data-line-number="29"><span class="co">    GIVEN a sequence input</span></a>
<a class="sourceLine" id="cb104-30" data-line-number="30"></a>
<a class="sourceLine" id="cb104-31" data-line-number="31"><span class="co">    WHEN the vector contains numeric values or logical that can be coerced to numeric</span></a>
<a class="sourceLine" id="cb104-32" data-line-number="32"></a>
<a class="sourceLine" id="cb104-33" data-line-number="33"><span class="co">    THEN a silent return occurs</span></a>
<a class="sourceLine" id="cb104-34" data-line-number="34"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb104-35" data-line-number="35">    <span class="cf">assert</span> _validate_numeric_sequence(<span class="bu">range</span>(<span class="dv">10</span>)) <span class="op">==</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb104-36" data-line-number="36">    <span class="cf">assert</span> _validate_numeric_sequence([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>]) <span class="op">==</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb104-37" data-line-number="37">    <span class="cf">assert</span> _validate_numeric_sequence((<span class="va">True</span>, <span class="va">False</span>)) <span class="op">==</span> <span class="va">None</span></a></code></pre></div>
<p>The above is a little more explicit and methodical regarding what we expect to occur. We can run these new tests on their own with the following. Note that <code>-v</code> is for verbose output which will print the path of the test.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="ex">pytest</span> -v tests/test_validation.py </a>
<a class="sourceLine" id="cb105-2" data-line-number="2">======================================== <span class="bu">test</span> session starts ========================================</a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="ex">platform</span> darwin -- Python 3.7.3, pytest-5.4.2, py-1.8.1, pluggy-0.13.1 -- /Users/b294776/Desktop/Workspace/Projects/misk/myfirstpypkg/venv/bin/python</a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="ex">cachedir</span>: .pytest_cache</a>
<a class="sourceLine" id="cb105-5" data-line-number="5"><span class="ex">rootdir</span>: /Users/b294776/Desktop/Workspace/Projects/misk/myfirstpypkg, inifile: setup.cfg</a>
<a class="sourceLine" id="cb105-6" data-line-number="6"><span class="ex">collected</span> 3 items                                                                                   </a>
<a class="sourceLine" id="cb105-7" data-line-number="7"></a>
<a class="sourceLine" id="cb105-8" data-line-number="8"><span class="ex">tests</span>/test_validation.py::<span class="ex">test_validate_sequence_type</span> PASSED                                  [ 33%]</a>
<a class="sourceLine" id="cb105-9" data-line-number="9"><span class="ex">tests</span>/test_validation.py::<span class="ex">test_validate_non_numeric_sequence</span> PASSED                           [ 66%]</a>
<a class="sourceLine" id="cb105-10" data-line-number="10"><span class="ex">tests</span>/test_validation.py::<span class="ex">test_validate_sequence_numeric</span> PASSED                               [100%]</a>
<a class="sourceLine" id="cb105-11" data-line-number="11"></a>
<a class="sourceLine" id="cb105-12" data-line-number="12">========================================= <span class="ex">3</span> passed in 0.02s =========================================</a></code></pre></div>
</div>
<div id="what-to-test-2" class="section level3">
<h3><span class="header-section-number">7.8.3</span> What to test</h3>
<p>Exactly what we want to test is a much harder concept to answer. We can certainly go over-board with testing if we try to capture every possible scenario. Our general approach is to test the main use-cases and then add to our test suite down the road as edge cases pop up.</p>
<p>Defining the main use-cases is not always easy. We typically look for:</p>
<ul>
<li>a couple basic uses cases that we feel the vast majority of users will apply,</li>
<li>a few expected edge cases such as if user supplies a <code>None</code> value or if there are upper limits to the expected inputs (what if a user supplies an interest rate parameter with a negative value or value greater than 100%),</li>
<li>expected messages, warnings, or errors designed specific for end-users.</li>
</ul>
<p>For example, our current test for our <code>my_mean()</code> function provides a very basic use case:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">def</span> test_my_mean():</a>
<a class="sourceLine" id="cb106-2" data-line-number="2">    x <span class="op">=</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">11</span>)</a>
<a class="sourceLine" id="cb106-3" data-line-number="3">    <span class="cf">assert</span> my_mean(x) <span class="op">==</span> <span class="dv">5</span></a></code></pre></div>
<p>We would likely want to expand this initially to capture a few expected scenarios. The below provides three distinct test purposes for our <code>my_mean()</code> function. If you run the following you will see that the second test fails because our original implementation does not handle <code>None</code> values. We would need to go back to that function and update it to deail with those values.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">def</span> test_my_mean_on_numeric_vectors():</a>
<a class="sourceLine" id="cb107-2" data-line-number="2">    <span class="co">&quot;&quot;&quot;Mean of numeric vectors compute accurately</span></a>
<a class="sourceLine" id="cb107-3" data-line-number="3"></a>
<a class="sourceLine" id="cb107-4" data-line-number="4"><span class="co">    GIVEN a sequence input</span></a>
<a class="sourceLine" id="cb107-5" data-line-number="5"></a>
<a class="sourceLine" id="cb107-6" data-line-number="6"><span class="co">    WHEN the data values are numeric or logical</span></a>
<a class="sourceLine" id="cb107-7" data-line-number="7"></a>
<a class="sourceLine" id="cb107-8" data-line-number="8"><span class="co">    THEN an arithmetic mean should be computed</span></a>
<a class="sourceLine" id="cb107-9" data-line-number="9"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb107-10" data-line-number="10">    <span class="cf">assert</span> my_mean(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">11</span>)) <span class="op">==</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb107-11" data-line-number="11">    <span class="cf">assert</span> my_mean([<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>]) <span class="op">==</span> <span class="fl">2.5</span></a>
<a class="sourceLine" id="cb107-12" data-line-number="12">    <span class="cf">assert</span> my_mean([<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>]) <span class="op">==</span> <span class="fl">0.5</span></a>
<a class="sourceLine" id="cb107-13" data-line-number="13">    <span class="cf">assert</span> my_mean(<span class="bu">range</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">11</span>)) <span class="op">==</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb107-14" data-line-number="14"></a>
<a class="sourceLine" id="cb107-15" data-line-number="15"><span class="kw">def</span> test_my_mean_ignore_none():</a>
<a class="sourceLine" id="cb107-16" data-line-number="16">    <span class="co">&quot;&quot;&quot;None values are ignored</span></a>
<a class="sourceLine" id="cb107-17" data-line-number="17"><span class="co">    GIVEN a sequence input that contains numeric values</span></a>
<a class="sourceLine" id="cb107-18" data-line-number="18"></a>
<a class="sourceLine" id="cb107-19" data-line-number="19"><span class="co">    WHEN the sequence also contains `None` values</span></a>
<a class="sourceLine" id="cb107-20" data-line-number="20"></a>
<a class="sourceLine" id="cb107-21" data-line-number="21"><span class="co">    THEN these irregular values should be stripped and the arithmetic mean computed</span></a>
<a class="sourceLine" id="cb107-22" data-line-number="22"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb107-23" data-line-number="23">    x <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">11</span>))</a>
<a class="sourceLine" id="cb107-24" data-line-number="24">    x <span class="op">+=</span> [<span class="va">None</span>]</a>
<a class="sourceLine" id="cb107-25" data-line-number="25">    <span class="cf">assert</span> my_mean(x) <span class="op">==</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb107-26" data-line-number="26"></a>
<a class="sourceLine" id="cb107-27" data-line-number="27"><span class="kw">def</span> test_my_mean_inadequate_inputs():</a>
<a class="sourceLine" id="cb107-28" data-line-number="28">    <span class="co">&quot;&quot;&quot;Inadequate input raise error.</span></a>
<a class="sourceLine" id="cb107-29" data-line-number="29"></a>
<a class="sourceLine" id="cb107-30" data-line-number="30"><span class="co">    GIVEN a user input</span></a>
<a class="sourceLine" id="cb107-31" data-line-number="31"></a>
<a class="sourceLine" id="cb107-32" data-line-number="32"><span class="co">    WHEN the input is not a vector with numeric values</span></a>
<a class="sourceLine" id="cb107-33" data-line-number="33"></a>
<a class="sourceLine" id="cb107-34" data-line-number="34"><span class="co">    THEN an error should be raised</span></a>
<a class="sourceLine" id="cb107-35" data-line-number="35"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb107-36" data-line-number="36">    <span class="cf">with</span> pytest.raises(<span class="pp">TypeError</span>):</a>
<a class="sourceLine" id="cb107-37" data-line-number="37">        my_mean(<span class="bu">list</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>))</a></code></pre></div>
<p>Also, note the first test and the repeated nature of the code. We could simplify this with what’s called “<em>parametrizing</em>” the test function. You can learn more about parametrization <a href="https://docs.pytest.org/en/2.8.7/parametrize.html">here</a>. This is how you would implement it for the first test. Parametrizing is a great thing to learn!</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="at">@pytest.mark.parametrize</span>(<span class="st">&quot;input, expected&quot;</span>,</a>
<a class="sourceLine" id="cb108-2" data-line-number="2">    [(<span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">11</span>), <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb108-3" data-line-number="3">     ([<span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">3.5</span>], <span class="fl">2.5</span>),</a>
<a class="sourceLine" id="cb108-4" data-line-number="4">     ([<span class="va">True</span>, <span class="va">True</span>, <span class="va">False</span>, <span class="va">False</span>], <span class="fl">0.5</span>),</a>
<a class="sourceLine" id="cb108-5" data-line-number="5">     (<span class="bu">range</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">11</span>), <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb108-6" data-line-number="6">    ]</a>
<a class="sourceLine" id="cb108-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb108-8" data-line-number="8"><span class="kw">def</span> test_my_mean_on_numeric_vectors(<span class="bu">input</span>, expected):</a>
<a class="sourceLine" id="cb108-9" data-line-number="9">    <span class="co">&quot;&quot;&quot;Mean of numeric vectors compute accurately</span></a>
<a class="sourceLine" id="cb108-10" data-line-number="10"></a>
<a class="sourceLine" id="cb108-11" data-line-number="11"><span class="co">    GIVEN a sequence input</span></a>
<a class="sourceLine" id="cb108-12" data-line-number="12"></a>
<a class="sourceLine" id="cb108-13" data-line-number="13"><span class="co">    WHEN the data values are numeric or logical</span></a>
<a class="sourceLine" id="cb108-14" data-line-number="14"></a>
<a class="sourceLine" id="cb108-15" data-line-number="15"><span class="co">    THEN an arithmetic mean should be computed</span></a>
<a class="sourceLine" id="cb108-16" data-line-number="16"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb108-17" data-line-number="17">    <span class="cf">assert</span> my_mean(<span class="bu">input</span>) <span class="op">==</span> expected</a></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="code.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="object-docs.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/bradleyboehmke/misk-packages/edit/master/06-testing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
